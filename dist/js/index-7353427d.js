import{T as e,d as o,r as a,av as l,b as t,ae as i,af as s,X as n,i as r,R as c,a8 as u,$ as d,c as v,a3 as m,ad as p,a4 as g,z as f,aY as h,m as w,I as b,a6 as y,x,aM as S,Y as z,a9 as P,a7 as C,aN as O,aK as R,K as k,aQ as I,a0 as j,aZ as L,a_ as U,a1 as Z,a2 as Y,au as B,P as X,aL as $,a5 as A,an as F,aO as V,aj as D,e as T,a$ as H,b0 as N,b1 as W,aS as E,A as M,b2 as K}from"./index-f678d2ce.js";import{a as q,S as Q}from"./index-3e2b2a78.js";import{m as _,u as G}from"./mount-component-58a305a9.js";const[J,ee]=e("image");const oe=y(o({name:J,props:{src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:m,height:m,radius:m,lazyLoad:Boolean,iconSize:m,showError:p,errorIcon:g("photo-fail"),iconPrefix:String,showLoading:p,loadingIcon:g("photo")},emits:["load","error"],setup(e,{emit:o,slots:m}){const p=a(!1),g=a(!0),y=a(),{$Lazyload:x}=l().proxy,S=t((()=>{const o={width:i(e.width),height:i(e.height)};return s(e.radius)&&(o.overflow="hidden",o.borderRadius=i(e.radius)),o}));n((()=>e.src),(()=>{p.value=!1,g.value=!0}));const z=e=>{g.value&&(g.value=!1,o("load",e))},P=()=>{const e=new Event("load");Object.defineProperty(e,"target",{value:y.value,enumerable:!0}),z(e)},C=e=>{p.value=!0,g.value=!1,o("error",e)},O=(o,a,l)=>l?l():v(b,{name:o,size:e.iconSize,class:a,classPrefix:e.iconPrefix},null),R=()=>{if(p.value||!e.src)return;const o={alt:e.alt,class:ee("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?f(v("img",w({ref:y},o),null),[[h("lazy"),e.src]]):v("img",w({ref:y,src:e.src,onLoad:z,onError:C},o),null)},k=({el:e})=>{const o=()=>{e===y.value&&g.value&&P()};y.value?o():d(o)},I=({el:e})=>{e!==y.value||p.value||C()};return x&&r&&(x.$on("loaded",k),x.$on("error",I),c((()=>{x.$off("loaded",k),x.$off("error",I)}))),u((()=>{d((()=>{var o;(null==(o=y.value)?void 0:o.complete)&&!e.lazyLoad&&P()}))})),()=>{var o;return v("div",{class:ee({round:e.round,block:e.block}),style:S.value},[R(),g.value&&e.showLoading?v("div",{class:ee("loading")},[O(e.loadingIcon,ee("loading-icon"),m.loading)]):p.value&&e.showError?v("div",{class:ee("error")},[O(e.errorIcon,ee("error-icon"),m.error)]):void 0,null==(o=m.default)?void 0:o.call(m)])}}})),ae=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),le=e("image-preview")[1];var te=o({props:{src:String,show:Boolean,active:Number,minZoom:C(m),maxZoom:C(m),rootWidth:C(Number),rootHeight:C(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:o,slots:l}){const i=x({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),s=S(),r=a(),c=a(),u=a(!1),d=a(!1);let m=0;const p=t((()=>{const{scale:e,moveX:o,moveY:a,moving:l,zooming:t,initializing:s}=i,n={transitionDuration:t||l||s?"0s":".3s"};return(1!==e||d.value)&&(n.transform=`matrix(${e}, 0, 0, ${e}, ${o}, ${a})`),n})),g=t((()=>{if(i.imageRatio){const{rootWidth:o,rootHeight:a}=e,l=u.value?a/i.imageRatio:o;return Math.max(0,(i.scale*l-o)/2)}return 0})),f=t((()=>{if(i.imageRatio){const{rootWidth:o,rootHeight:a}=e,l=u.value?a:o*i.imageRatio;return Math.max(0,(i.scale*l-a)/2)}return 0})),h=(a,l)=>{var t;if((a=R(a,+e.minZoom,+e.maxZoom+1))!==i.scale){const s=a/i.scale;if(i.scale=a,l){const e=j(null==(t=r.value)?void 0:t.$el),o={x:.5*e.width,y:.5*e.height},a=i.moveX-(l.x-e.left-o.x)*(s-1),n=i.moveY-(l.y-e.top-o.y)*(s-1);i.moveX=R(a,-g.value,g.value),i.moveY=R(n,-f.value,f.value)}else i.moveX=0,i.moveY=d.value?m:0;o("scale",{scale:a,index:e.active})}},w=()=>{h(1)};let b,y,C,Z,Y,B,X,$,A=!1;const F=o=>{const{touches:a}=o;if(b=a.length,2===b&&e.disableZoom)return;const{offsetX:l}=s;s.start(o),y=i.moveX,C=i.moveY,$=Date.now(),A=!1,i.moving=1===b&&(1!==i.scale||d.value),i.zooming=2===b&&!l.value,i.zooming&&(Z=i.scale,Y=ae(a))},V=a=>{var l;if(b>1)return;const{offsetX:t,offsetY:n}=s,r=Date.now()-$;if(t.value<L&&n.value<L)if(r<250)if(e.doubleScale)if(X)clearTimeout(X),X=null,(()=>{const e=i.scale>1?1:2;h(e,2===e||d.value?{x:s.startX.value,y:s.startY.value}:void 0)})();else{if(!e.closeOnClickOverlay&&a.target===(null==(l=c.value)?void 0:l.$el))return;X=setTimeout((()=>{o("close"),X=null}),250)}else o("close");else r>U&&o("longPress")},D=o=>{let a=!1;if((i.moving||i.zooming)&&(a=!0,i.moving&&y===i.moveX&&C===i.moveY&&(a=!1),!o.touches.length)){i.zooming&&(i.moveX=R(i.moveX,-g.value,g.value),i.moveY=R(i.moveY,-f.value,f.value),i.zooming=!1),i.moving=!1,y=0,C=0,Z=1,i.scale<1&&w();const o=+e.maxZoom;i.scale>o&&h(o,B)}O(o,a),V(o),s.reset()},T=()=>{const{rootWidth:o,rootHeight:a}=e,l=a/o,{imageRatio:t}=i;u.value=i.imageRatio>l&&t<2.6,d.value=i.imageRatio>l&&t>=2.6,d.value&&(m=(t*o-a)/2,i.moveY=m,i.initializing=!0,k((()=>{i.initializing=!1}))),w()},H=e=>{const{naturalWidth:o,naturalHeight:a}=e.target;i.imageRatio=a/o,T()};return n((()=>e.active),w),n((()=>e.show),(e=>{e||w()})),n((()=>[e.rootWidth,e.rootHeight]),T),z("touchmove",(e=>{const{touches:o}=e;if(s.move(e),i.moving){const{deltaX:o,deltaY:a}=s,l=o.value+y,t=a.value+C;if((l>g.value||l<-g.value)&&!A&&s.isHorizontal())return void(i.moving=!1);A=!0,O(e,!0),i.moveX=R(l,-g.value,g.value),i.moveY=R(t,-f.value,f.value)}if(i.zooming&&(O(e,!0),2===o.length)){const e=ae(o),a=Z*e/Y;B=(e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}))(o),h(a,B)}}),{target:t((()=>{var e;return null==(e=c.value)?void 0:e.$el}))}),P({resetScale:w}),()=>{const o={loading:()=>v(I,{type:"spinner"},null)};return v(q,{ref:c,class:le("swipe-item"),onTouchstartPassive:F,onTouchend:D,onTouchcancel:D},{default:()=>[l.image?v("div",{class:le("image-wrap")},[l.image({src:e.src})]):v(oe,{ref:r,src:e.src,fit:"contain",class:le("image",{vertical:u.value}),style:p.value,onLoad:H},o)]})}}});const[ie,se]=e("image-preview"),ne=["show","teleport","transition","overlayStyle","closeOnPopstate"];var re=o({name:ie,props:{show:Boolean,loop:p,images:$(),minZoom:A(1/3),maxZoom:A(3),overlay:p,closeable:Boolean,showIndex:p,className:F,closeIcon:g("clear"),transition:String,beforeClose:Function,doubleScale:p,overlayClass:F,overlayStyle:Object,swipeDuration:A(300),startPosition:A(0),showIndicators:Boolean,closeOnPopstate:p,closeOnClickOverlay:p,closeIconPosition:g("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:o,slots:l}){const t=a(),i=a(),s=x({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),r=()=>{if(t.value){const e=j(t.value.$el);s.rootWidth=e.width,s.rootHeight=e.height,t.value.resize()}},c=e=>o("scale",e),m=e=>o("update:show",e),p=()=>{D(e.beforeClose,{args:[s.active],done:()=>m(!1)})},g=e=>{e!==s.active&&(s.active=e,o("change",e))},f=()=>{if(e.showIndex)return v("div",{class:se("index")},[l.index?l.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},h=()=>{if(l.cover)return v("div",{class:se("cover")},[l.cover()])},y=()=>{s.disableZoom=!0},S=()=>{s.disableZoom=!1},z=()=>{if(e.closeable)return v(b,{role:"button",name:e.closeIcon,class:[se("close-icon",e.closeIconPosition),V],onClick:p},null)},C=()=>o("closed"),O=(e,o)=>{var a;return null==(a=t.value)?void 0:a.swipeTo(e,o)};return P({resetScale:()=>{var e;null==(e=i.value)||e.resetScale()},swipeTo:O}),u(r),n([Z,Y],r),n((()=>e.startPosition),(e=>g(+e))),n((()=>e.show),(a=>{const{images:l,startPosition:t}=e;a?(g(+t),d((()=>{r(),O(+t,{immediate:!0})}))):o("close",{index:s.active,url:l[s.active]})})),()=>v(X,w({class:[se(),e.className],overlayClass:[se("overlay"),e.overlayClass],onClosed:C,"onUpdate:show":m},B(e,ne)),{default:()=>[z(),v(Q,{ref:t,lazyRender:!0,loop:e.loop,class:se("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:g,onDragEnd:S,onDragStart:y},{default:()=>[e.images.map(((a,t)=>v(te,{ref:e=>{t===s.active&&(i.value=e)},src:a,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:c,onClose:p,onLongPress:()=>o("longPress",{index:t})},{image:l.image})))]}),f(),h()]})}});let ce;const ue={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};const de=(e,o=0)=>{if(r)return ce||({instance:ce}=_({setup(){const{state:e,toggle:o}=G(),a=()=>{e.images=[]};return()=>v(re,w(e,{onClosed:a,"onUpdate:show":o}),null)}})),e=Array.isArray(e)?{images:e,startPosition:o}:e,ce.open(T({},ue,e)),ce};y(re);const[ve,me,pe]=e("uploader");function ge(e,o){return new Promise((a=>{if("file"===o)return void a();const l=new FileReader;l.onload=e=>{a(e.target.result)},"dataUrl"===o?l.readAsDataURL(e):"text"===o&&l.readAsText(e)}))}function fe(e,o){return H(e).some((e=>!!e.file&&(N(o)?o(e.file):e.file.size>+o)))}const he=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i;function we(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?(o=e.url,he.test(o)):"string"==typeof e.content&&0===e.content.indexOf("data:image"));var o}var be=o({props:{name:m,item:C(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:o,slots:a}){const l=()=>{const{status:o,message:a}=e.item;if("uploading"===o||"failed"===o){const e="failed"===o?v(b,{name:"close",class:me("mask-icon")},null):v(I,{class:me("loading")},null),l=s(a)&&""!==a;return v("div",{class:me("mask")},[e,l&&v("div",{class:me("mask-message")},[a])])}},t=a=>{const{name:l,item:t,index:i,beforeDelete:s}=e;a.stopPropagation(),D(s,{args:[t,{name:l,index:i}],done:()=>o("delete")})},i=()=>o("preview"),n=()=>o("reupload"),r=()=>{if(e.deletable&&"uploading"!==e.item.status){const e=a["preview-delete"];return v("div",{role:"button",class:me("preview-delete",{shadow:!e}),tabindex:0,"aria-label":pe("delete"),onClick:t},[e?e():v(b,{name:"cross",class:me("preview-delete-icon")},null)])}},c=()=>{if(a["preview-cover"]){const{index:o,item:l}=e;return v("div",{class:me("preview-cover")},[a["preview-cover"](T({index:o},l))])}},u=()=>{const{item:o,lazyLoad:a,imageFit:l,previewSize:t,reupload:s}=e;return we(o)?v(oe,{fit:l,src:o.objectUrl||o.content||o.url,class:me("preview-image"),width:Array.isArray(t)?t[0]:t,height:Array.isArray(t)?t[1]:t,lazyLoad:a,onClick:s?n:i},{default:c}):v("div",{class:me("file"),style:W(e.previewSize)},[v(b,{class:me("file-icon"),name:"description"},null),v("div",{class:[me("file-name"),"van-ellipsis"]},[o.file?o.file.name:o.url]),c()])};return()=>v("div",{class:me("preview")},[u(),l(),r()])}});const ye=y(o({name:ve,props:{name:A(""),accept:g("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:A(1/0),imageFit:g("cover"),resultType:g("dataUrl"),uploadIcon:g("photograph"),uploadText:String,deletable:p,reupload:Boolean,afterRead:Function,showUpload:p,modelValue:$(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:p,previewOptions:Object,previewFullImage:p,maxSize:{type:[Number,String,Function],default:1/0}},emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:o,slots:l}){const t=a(),i=[],s=a(-1),n=a(!1),r=(o=e.modelValue.length)=>({name:e.name,index:o}),u=()=>{t.value&&(t.value.value="")},m=a=>{if(u(),fe(a,e.maxSize)){if(!Array.isArray(a))return void o("oversize",a,r());{const l=function(e,o){const a=[],l=[];return e.forEach((e=>{fe(e,o)?l.push(e):a.push(e)})),{valid:a,invalid:l}}(a,e.maxSize);if(a=l.valid,o("oversize",l.invalid,r()),!a.length)return}}if(a=x(a),s.value>-1){const l=[...e.modelValue];l.splice(s.value,1,a),o("update:modelValue",l),s.value=-1}else o("update:modelValue",[...e.modelValue,...H(a)]);e.afterRead&&e.afterRead(a,r())},p=o=>{const{maxCount:a,modelValue:l,resultType:t}=e;if(Array.isArray(o)){const e=+a-l.length;o.length>e&&(o=o.slice(0,e)),Promise.all(o.map((e=>ge(e,t)))).then((e=>{const a=o.map(((o,a)=>{const l={file:o,status:"",message:"",objectUrl:URL.createObjectURL(o)};return e[a]&&(l.content=e[a]),l}));m(a)}))}else ge(o,t).then((e=>{const a={file:o,status:"",message:"",objectUrl:URL.createObjectURL(o)};e&&(a.content=e),m(a)}))},g=o=>{const{files:a}=o.target;if(e.disabled||!a||!a.length)return;const l=1===a.length?a[0]:[].slice.call(a);if(e.beforeRead){const o=e.beforeRead(l,r());if(!o)return void u();if(K(o))return void o.then((e=>{p(e||l)})).catch(u)}p(l)};let h;const y=()=>o("closePreview"),S=()=>{n.value||(s.value=-1),n.value=!1},z=(a,t)=>{const c=["imageFit","deletable","reupload","previewSize","beforeDelete"],u=T(B(e,c),B(a,c,!0));return v(be,w({item:a,index:t,onClick:()=>o(e.reupload?"clickReupload":"clickPreview",a,r(t)),onDelete:()=>((a,l)=>{const t=e.modelValue.slice(0);t.splice(l,1),o("update:modelValue",t),o("delete",a,r(l))})(a,t),onPreview:()=>(o=>{if(e.previewFullImage){const a=e.modelValue.filter(we),l=a.map((e=>(e.objectUrl&&!e.url&&"failed"!==e.status&&(e.url=e.objectUrl,i.push(e.url)),e.url))).filter(Boolean);h=de(T({images:l,startPosition:a.indexOf(o),onClose:y},e.previewOptions))}})(a),onReupload:()=>(e=>{n.value=!0,s.value=e,d((()=>k()))})(t)},B(e,["name","lazyLoad"]),u),B(l,["preview-cover","preview-delete"]))},C=()=>{if(e.previewImage)return e.modelValue.map(z)},O=e=>o("clickUpload",e),R=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const o=e.modelValue.length>=+e.maxCount&&e.reupload,a=e.readonly?null:v("input",{ref:t,type:"file",class:me("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&-1===s.value,disabled:e.disabled,onChange:g,onClick:S},null);return l.default?f(v("div",{class:me("input-wrapper"),onClick:O},[l.default(),a]),[[M,!o]]):f(v("div",{class:me("upload",{readonly:e.readonly}),style:W(e.previewSize),onClick:O},[v(b,{name:e.uploadIcon,class:me("upload-icon")},null),e.uploadText&&v("span",{class:me("upload-text")},[e.uploadText]),a]),[[M,e.showUpload&&!o]])},k=()=>{t.value&&!e.disabled&&t.value.click()};return c((()=>{i.forEach((e=>URL.revokeObjectURL(e)))})),P({chooseFile:k,closeImagePreview:()=>{h&&h.close()}}),E((()=>e.modelValue)),()=>v("div",{class:me()},[v("div",{class:me("wrapper",{disabled:e.disabled})},[C(),R()])])}}));export{ye as U};
