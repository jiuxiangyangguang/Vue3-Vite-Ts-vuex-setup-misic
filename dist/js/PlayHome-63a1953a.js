import{d as t,aC as e,r as a,b as i,X as o,f as n,g as c,h as l,ax as r,k as s,c as d,B as u,t as h,C as v,z as p,A as f,F as y,aD as m,D as g,aE as x,aF as w,aG as b,I as S,q as A,G as C,H as _,_ as M,$ as k,y as P,u as z,l as I,aH as H,aI as E,a as B,o as L,s as R,p as T,aJ as j}from"./index-f678d2ce.js";import{T as q}from"./index-94d083dc.js";const D=(t=>(C("data-v-a94e9959"),t=t(),_(),t))((()=>l("div",{class:"title"},"请选择下载音质",-1))),O={class:"progressbar"},$={class:"text"},F={class:"text"},U={class:"icon"},W=M(t({__name:"PlayCont",setup(t){m((t=>({"22cca34c":B.value})));const C=e(),_=a(""),M=a(!1),k=a(),P=i((()=>C.state.userInfo.likeArr)),z=i((()=>C.state.audio.playFlag)),I=i((()=>C.state.audio.index)),H=i((()=>C.state.audio.mode)),E=i((()=>C.state.skin.progress)),B=i((()=>C.state.skin.lineColor)),L=i((()=>C.state.audio.currentPlay)),R=i((()=>C.state.audio.currentAudioLength)),T=i((()=>C.state.audio.durationAudioLength)),j=a(),W=a(),N=a(),G=a(!1),X=a(0),V=a(0),J=a(!1),K=g(),Q=i((()=>P.value.some((t=>t===L.value[I.value].id)))),Y=()=>{C.commit("setPlayFlags")},Z=async()=>{k.value.classList.add("anim-one"),setTimeout((()=>{k.value.classList.remove("anim-one")}),500);const t=Q.value?"setlikeArrRef":"setlikeArrAdd";C.commit(t,L.value[I.value].id),await x({like:Q.value,id:L.value[I.value].id})},tt=async t=>{const{data:e}=await w({id:L.value[I.value].id,br:t});J.value=!1,e.url?(fetch(e.url).then((t=>t.blob())).then((t=>{const e=document.createElement("a");document.body.appendChild(e),e.style.display="none";const a=window.URL.createObjectURL(t);e.href=a,e.download=`${L.value[I.value].name}-${L.value[I.value].songName}.mp3`,e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(a)})),C.commit("setLocalMusic",L.value[I.value])):q.fail("当前歌曲不支持下载")},et=async()=>{await b({id:L.value[I.value].id,limit:30})},at=t=>{G.value=!0;const e=N.value.offsetLeft;V.value=N.value.clientWidth;const a=t.targetTouches[0].pageX;X.value=a-e,X.value>=V.value&&(X.value=V.value),X.value<0&&(X.value=0),W.value.style.left=`${X.value}px`,j.value.style.width=`${X.value}px`},it=()=>{G.value=!1;const t=X.value/V.value*T.value;C.commit("setSetCurrentLen",t)},ot=()=>{C.commit("setIndex",I.value-1)},nt=()=>{C.commit("setIndex",I.value+1)},ct=()=>{M.value=!0,setTimeout((()=>{M.value=!1}),2e3);let t=H.value+1>=3?0:H.value+1;_.value=0===t?"列表循环":1===t?"随机播放":"单曲循环",C.commit("setMode",t)},lt=()=>{C.commit("setShowPlayList")};return o(R,(()=>{if(G.value)return;const t=100*Math.ceil(R.value)/Math.ceil(T.value);j.value.style.width=`${t}%`,W.value.style.left=`${t}%`})),(t,e)=>{const a=S,i=A;return n(),c(y,null,[J.value?(n(),c("div",{key:0,class:"mask",onClick:e[4]||(e[4]=t=>J.value=!1)},[l("div",{class:"updomn",onClick:e[3]||(e[3]=r((()=>{}),["stop"]))},[D,l("p",{onClick:e[0]||(e[0]=t=>tt(128e3))},"标准"),l("p",{onClick:e[1]||(e[1]=t=>tt(32e4))},"较高"),l("p",{onClick:e[2]||(e[2]=t=>tt(999e3))},"极高(无损)")])])):s("",!0),l("div",{class:"collection",ref_key:"collection",ref:k},[d(a,{name:"like",color:Q.value?"#ff5345":"#eee",onClick:Z},null,8,["color"]),d(a,{name:"upgrade",color:"#fff",style:u({transform:"rotate(180deg)"}),onClick:e[5]||(e[5]=t=>J.value=!0)},null,8,["style"]),d(a,{name:"chat-o",color:"#fff",onClick:et})],512),l("div",O,[l("span",$,h(v(K).getMS(R.value)),1),l("div",{class:"progress",ref_key:"progress",ref:N},[l("div",{class:"speed",ref_key:"speed",ref:j},null,512),l("div",{class:"dot",ref_key:"dot",ref:W,onTouchmove:at,onTouchend:it},[d(i,{name:E.value},null,8,["name"])],544)],512),l("span",F,h(v(K).getMS(T.value)),1)]),l("div",U,[d(i,{name:1===H.value?"sjbf":0===H.value?"lbbf":"dqxh",style:u({fontSize:"18px",color:B.value}),onClick:ct},null,8,["name","style"]),d(i,{name:"prev",onClick:ot}),d(a,{onClick:Y,name:z.value?"pause-circle-o":"play-circle-o"},null,8,["name"]),d(i,{name:"next",onClick:nt}),d(i,{name:"bflb",style:{"font-size":"18px"},onClick:lt})]),p(l("div",{class:"msak"},h(_.value),513),[[f,M.value]])],64)}}}),[["__scopeId","data-v-a94e9959"]]),N={class:"progressbar"},G=M(t({__name:"Volume",setup(t){const r=e(),s=a(),u=i((()=>r.state.audio.volume)),h=a(),v=a(),p=a(0),f=a(0),y=t=>{const e=v.value.offsetLeft;f.value=v.value.clientWidth;const a=t.targetTouches[0].pageX;p.value=a-e,p.value>=f.value&&(p.value=f.value),p.value<0&&(p.value=0),h.value.style.left=`${p.value}px`,s.value.style.width=`${p.value}px`,r.commit("setVolume",p.value/f.value)};return o(u,(async()=>{await k(),f.value=v.value.clientWidth,p.value=f.value*u.value,h.value.style.left=`${p.value}px`,s.value.style.width=`${p.value}px`}),{immediate:!0}),(t,e)=>{const a=A;return n(),c("div",N,[d(a,{name:"volume100",style:{color:"#dcdbdb","font-size":"12px"}}),l("div",{class:"progressbgc",ref_key:"progress",ref:v},[l("div",{class:"progressline",ref_key:"speed",ref:s},null,512),l("div",{class:"dot",ref_key:"dot",ref:h,onTouchmove:y},null,544)],512)])}}}),[["__scopeId","data-v-fcfe132f"]]),X=M(t({__name:"LyricCom",emits:["showlyric"],setup(t,{emit:e}){m((t=>({"398ff9d7":w.value})));const r=P(),s=z(),d=a(),u=i((()=>s.state.audio.currentAudioLength)),v=a([]),p=a(0),f=i((()=>s.state.audio.index)),g=i((()=>s.state.audio.currentPlay)),x=i((()=>s.state.audio.currentPlayLen)),w=i((()=>s.state.skin.lineColor)),b=e,S=async t=>{const{lrc:{lyric:e}}=await H({id:t}),a=[];e.split("\n").forEach((t=>{const e=Number(60*t.slice(1,3))+Number(t.slice(4,6)),i=t.indexOf("]");a.push({time:e,text:t.slice(i+1,t.length)})})),v.value=a};return o(u,(t=>{const e=v.value.findIndex((e=>e.time===Math.floor(t)));-1!==e&&(p.value=e)})),o(p,(async()=>{if("/play"!==r.path)return;const t=p.value,e=document.querySelectorAll("li span");e.forEach((t=>{t.style.transition="background-size 0s linear",t.style.backgroundSize="0"}));const a=v.value[t+1].time-v.value[t].time;e[t].style.transition=`background-size ${a}s linear`,e[t].style.backgroundSize="100%",d.value.style.top=`-${40*t}px`})),o([x,f,g],(()=>{x.value&&(p.value=0,S(g.value[f.value].id))})),S(r.query.id),(t,e)=>(n(),c("div",{class:"lyric",onClick:e[0]||(e[0]=t=>b("showlyric"))},[l("ul",{ref_key:"ul",ref:d},[(n(!0),c(y,null,I(v.value,(t=>(n(),c("li",null,[l("span",null,h(t.text),1)])))),256))],512)]))}}),[["__scopeId","data-v-21831933"]]);var V={exports:{}};const J=E(V.exports=function(){var t={effect:"waveform",accuracy:128,waveform:{maxHeight:80,minHeight:1,spacing:1,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle",prettify:!0},circlewave:{maxHeight:20,minHeight:-5,spacing:1,color:"#fcc",shadowBlur:2,shadowColor:"#caa",fadeSide:!0,prettify:!1,particle:!0,maxParticle:100,circleRadius:128,showProgress:!0},circlebar:{maxHeight:50,minHeight:1,spacing:1,color:"#fcc",shadowBlur:2,shadowColor:"#caa",fadeSide:!0,prettify:!1,particle:!0,maxParticle:100,circleRadius:128,showProgress:!0},lighting:{maxHeight:160,maxSize:8,lineWidth:2,color:"#fcc",shadowBlur:1,shadowColor:"#c20",fadeSide:!0,prettify:!0,horizontalAlign:"center",verticalAlign:"middle"}};function e(e,i,o){if(-1===["[object HTMLAudioSource]","[object HTMLAudioElement]","[object MediaStream]"].indexOf(Object.prototype.toString.call(e)))throw new TypeError("Invaild Audio Source");if("[object HTMLCanvasElement]"!==Object.prototype.toString.call(i))throw new TypeError("Invaild Canvas Element");this.audioSrc=e,this.canvasEle=i,this.option=a(t,o),this.meta={},this.stat=0,this.freqByteData=null,this.particles=[],this.coverImg=new Image,this.__init()}function a(){var t={};return Array.prototype.forEach.call(arguments,(function(e){var i;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&("[object Object]"===Object.prototype.toString.call(e[i])?t[i]=a(t[i],e[i]):t[i]=e[i])})),t}function i(t){this.x=t.x||0,this.y=t.y||0,this.vx=t.vx||Math.random()-.5,this.vy=t.vy||Math.random()-.5,this.size=t.size||3*Math.random(),this.life=t.life||5*Math.random(),this.dead=!1,this.alpha=1,this.rotate=0,this.color=t.color||"rgba(244,244,244,.9)",this.type=t.type||"circle",this.update=o,this.render=n}function o(t){if(this.x+=this.vx,this.y+=this.vy,this.life-=.01,this.alpha-=.003,this.rotate+=.01*Math.random(),this.life<0)return this.dead=!0,void(this.alpha=0);this.render(t)}function n(t){var e=this,a=t.globalAlpha;t.fillStyle=e.color,"circle"===e.type?(t.beginPath(),t.globalAlpha=e.alpha,t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill()):(t.save(),t.translate(e.x,e.y),t.rotate(e.rotate),t.rect(0,0,e.size,e.size),t.restore(),t.fill()),t.globalAlpha=a}return e.prototype={__init:function(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),e="[object MediaStream]"!==Object.prototype.toString.call(this.audioSrc)?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc);this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,e.connect(this.analyser),this.analyser.fftSize=2*this.option.accuracy,this.analyser.connect(t.destination),this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.coverImg.src=this.option.circlewave.coverImg||"",this.context2d=this.canvasEle.getContext("2d");var a=document.createElement("canvas");this.memCtx=a.getContext("2d"),this.effects=this.__effects(),this.__resizeCanvas(),this.canvasEle.addEventListener("click",function(){0===this.stat?(this.audioSrc.play(),this.dance()):(this.pause(),this.audioSrc.pause())}.bind(this)),window.onresize=this.__resizeCanvas.bind(this)},__resizeCanvas(){var t=window.devicePixelRatio||1;this.width=this.canvasEle.clientWidth,this.height=this.canvasEle.clientHeight,this.canvasEle.width=this.width*t,this.canvasEle.height=this.height*t,this.context2d.scale(t,t),this.context2d.globalCompositeOperation="lighter",this.memCtx.canvas.width=this.width*t,this.memCtx.canvas.height=this.height*t,this.memCtx.scale(t,t)},__recreateAnalyzer(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),e="[object MediaStream]"!==Object.prototype.toString.call(this.audioSrc)?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc);this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,e.connect(this.analyser),this.analyser.fftSize=2*this.option.accuracy,this.analyser.connect(t.destination)},__rebuildData:function(t,e){return"center"===e?[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)):"left"===e?t:"right"===e?Array.from(t).reverse():[].concat(Array.from(t).reverse().slice(this.option.accuracy/2,this.option.accuracy),Array.from(t).slice(0,this.option.accuracy/2))},readAudioSrc:function(t,e,a){if(0!==t.files.length){var i=t.files[0],o=new FileReader;0===i.type.indexOf("audio")&&(a.innerText=i.name,o.onload=function(t){e.audioSrc.src=t.target.result,e.audioSrc.play(),e.dance()},o.readAsDataURL(i))}else a.innerText="Drop Audio file here to play"},__animate:function(){1===this.stat&&(this.analyser.getByteFrequencyData(this.freqByteData),"function"==typeof this.effects[this.option.effect]&&this.effects[this.option.effect](this.freqByteData),requestAnimationFrame(this.__animate.bind(this)))},__testFrame:function(){this.analyser.getByteFrequencyData(this.freqByteData),"function"==typeof this.__effects()[this.option.effect]&&this.__effects()[this.option.effect](this.freqByteData)},__renderMemParticles:function(t,e,a){this.particles.find((function(t){return t.dead})),this.particles.length>50?this.particles.shift():this.particles.push(new i({x:Math.random()*this.width,y:100*Math.random()-50+this.height/2,vx:.2*Math.random()-.3,vy:.3*Math.random()-.4,size:5*Math.random(),life:50*Math.random(),type:a,color:e})),this.particles.forEach((t=>{t.update(this.context2d)}))},__effects:function(){var t=this,e=[];return{lighting:function(a){var i,o,n,c=t.option.lighting,l=t.__rebuildData(a,c.horizontalAlign),r=c.maxHeight,s=c.prettify,d=c.dottify,u=c.maxSize,h=c.color,v=!0,p=!0;"center"!==c.horizontalAlign&&(p=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.lineWidth=c.lineWidth,t.context2d.strokeStyle="rgba(200, 200, 200, .2)",t.context2d.fillStyle="rgba(200, 200, 200, .2)",t.context2d.globalAlpha=.8,t.context2d.beginPath(),t.context2d.shadowBlur=4,t.context2d.shadowColor=t.context2d.fillStyle,t.__renderMemParticles(null,t.context2d.shadowColor,"rect"),h instanceof Array?(n=t.context2d.createLinearGradient(0,t.height/2,t.width,t.height/2),h.forEach((function(t,e){var a,i;i=t instanceof Array?t[1]:t,a=e/h.length,n.addColorStop(a,i)})),t.context2d.fillStyle=n,t.context2d.strokeStyle=n):(t.context2d.fillStyle=h,t.context2d.strokeStyle=h),l.forEach((function(a,n){r=s?n<t.option.accuracy/2?(1-(t.option.accuracy/2-1-n)/(t.option.accuracy/2))*c.maxHeight:(1-(n-t.option.accuracy/2)/(t.option.accuracy/2))*c.maxHeight:c.maxHeight,p?n<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-n)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(n-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,i=t.width/t.option.accuracy*n;var l=a/256*r;o="middle"===c.verticalAlign?(t.height-l)/2:"bottom"===c.verticalAlign?t.height-l:"top"===c.verticalAlign?l:(t.height-l)/2,d&&0!==n&&n%2==0?(t.context2d.beginPath(),e[n]=void 0!==e[n]?e[n]:Math.random()*u+1,t.context2d.arc(i,o,e[n],0,2*Math.PI),t.context2d.fill()):d||(v?(t.context2d.moveTo(i,o),v=!1):t.context2d.lineTo(i,o))})),d||(t.context2d.stroke(),t.context2d.globalAlpha=.6,t.context2d.fill())},circlewave:function(e){var a,o,n,c,l=t.option.circlewave,r=l.fadeSide,s=l.prettify,d=t.__rebuildData(e,l.horizontalAlign),u=2*Math.PI/d.length,h=l.circleRadius,v=l.particle,p=l.maxParticle,f=l.showProgress,y=t.audioSrc.currentTime/t.audioSrc.duration,m=!0;if(n=l.color,"center"!==l.horizontalAlign&&(r=!1,s=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.save(),t.context2d.lineWidth=4,t.context2d.fillStyle="rgba(200, 200, 200, .2)",t.context2d.translate(t.width/2-.5,t.height/2-.5),l.shadowBlur>0&&(t.context2d.shadowBlur=l.shadowBlur,t.context2d.shadowColor=l.shadowColor),v){if(t.particles.find((function(t){return t.dead})),t.particles.length>p)t.particles.shift();else{const e=Math.random()*Math.PI*2;t.particles.push(new i({x:(h+30)*Math.sin(e),y:(h+30)*Math.cos(e),vx:.3*Math.sin(e)+.5*Math.random()-.3,vy:.3*Math.cos(e)+.5*Math.random()-.3,life:10*Math.random()}))}t.particles.forEach((e=>{e.update(t.context2d)}))}t.context2d.beginPath(),d.forEach((function(e,i){Math.PI,t.option.accuracy,l.spacing,t.option.accuracy,l.spacing,1!==l.spacing&&l.spacing,a=s?i<=t.option.accuracy/2?(1-(t.option.accuracy/2-1-i)/(t.option.accuracy/2))*l.maxHeight:(1-(i-t.option.accuracy/2)/(t.option.accuracy/2))*l.maxHeight:l.maxHeight,o=(o=e/256*a)<l.minHeight?l.minHeight:o,n instanceof Array?(c=t.context2d.createLinearGradient(-h-a,-h-a,h+a,h+a),n.forEach((function(t,e){var a,i;i=t instanceof Array?t[1]:t,a=e/n.length,c.addColorStop(a,i)})),t.context2d.strokeStyle=c,t.context2d.fillStyle=c):(t.context2d.strokeStyle=n,t.context2d.fillStyle=n),r?i<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-i)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(i-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1;var d=u*i,v=Math.sin(d)*(h+o),p=Math.cos(d)*(h+o);m?(t.context2d.moveTo(v,p),m=!1):t.context2d.lineTo(v,p)}));var g=t.context2d.globalAlpha;t.context2d.closePath(),t.context2d.stroke(),t.context2d.globalAlpha=.5,t.context2d.fill(),t.context2d.globalAlpha=g,f&&t.drawProgress(n,y,h),t.drawCover(y,h),t.context2d.restore()},circlebar:function(e){var a=t.option.circlebar,o=a.fadeSide;a.prettify;var n,c,l,r=t.__rebuildData(e,a.horizontalAlign),s=2*Math.PI/r.length,d=a.circleRadius,u=a.particle,h=a.maxParticle,v=a.showProgress,p=t.audioSrc.currentTime/t.audioSrc.duration,f=0;if("center"!==a.horizontalAlign&&(o=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.save(),t.context2d.translate(t.width/2-.5,t.height/2-.5),a.shadowBlur>0&&(t.context2d.shadowBlur=a.shadowBlur,t.context2d.shadowColor=a.shadowColor),u){if(t.particles.find((function(t){return t.dead})),t.particles.length>h)t.particles.shift();else{const e=Math.random()*Math.PI*2;t.particles.push(new i({x:(d+20)*Math.sin(e),y:(d+20)*Math.cos(e),vx:.3*Math.sin(e)+.5*Math.random()-.3,vy:.3*Math.cos(e)+.5*Math.random()-.3,life:10*Math.random()}))}t.particles.forEach((e=>{e.update(t.context2d)}))}f=-(n=(d*Math.PI-t.option.accuracy*a.spacing)/t.option.accuracy)/2;var y=(l=a.color)instanceof Array?l[0]:l;t.context2d.fillStyle=y,t.context2d.strokeStyle=y,t.context2d.lineWidth=4,t.context2d.lineCap="round",t.context2d.shadowBlur=8,t.context2d.globalAlpha=1,t.context2d.beginPath();for(var m=r.length-1;m>=0;m--){var g=r[m];a.spacing,1!==a.spacing&&a.spacing,c=(c=g/256*a.maxHeight)<a.minHeight?a.minHeight:c,o&&(m<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-m)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(m-t.option.accuracy/2)/(t.option.accuracy/2)),t.context2d.rotate(s),t.context2d.fillRect(f,d,n,c),t.context2d.fill()}v&&t.drawProgress(null,p,d),t.drawCover(p,d),t.context2d.restore()},waveform:function(e){var a,i,o,n,c,l,r,s,d=t.option.waveform,u=d.fadeSide,h=d.prettify,v=t.__rebuildData(e,d.horizontalAlign);"center"!==d.horizontalAlign&&(u=!1,h=!1),t.context2d.clearRect(0,0,t.width,t.height),v.forEach((function(e,v){i=(t.width-t.option.accuracy*d.spacing)/t.option.accuracy,n=v*(i+d.spacing),1!==d.spacing&&(n+=d.spacing/2),a=h?v<=t.option.accuracy/2?(1-(t.option.accuracy/2-1-v)/(t.option.accuracy/2))*d.maxHeight:(1-(v-t.option.accuracy/2)/(t.option.accuracy/2))*d.maxHeight:d.maxHeight,o=(o=e/256*a)<d.minHeight?d.minHeight:o,c="middle"===d.verticalAlign?(t.height-o)/2:"top"===d.verticalAlign?0:"bottom"===d.verticalAlign?t.height-o:(t.height-o)/2,(l=d.color)instanceof Array?(r=t.context2d.createLinearGradient(n,c,n,c+o),l.forEach((function(t,e){t instanceof Array?(s=t[0],t=t[1]):s=0===e||e===l.length-1?e/(l.length-1):e/l.length+.5/l.length,r.addColorStop(s,t)})),t.context2d.fillStyle=r):t.context2d.fillStyle=l,d.shadowBlur>0&&(t.context2d.shadowBlur=d.shadowBlur,t.context2d.shadowColor=d.shadowColor),u?v<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-v)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(v-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,t.context2d.fillRect(n,c,i,o)}))}}},dance:function(){return 0!==this.stat&&"suspended"!==this.analyser.context.state||(this.analyser.context.resume(),this.stat=1,this.__animate()),this},pause:function(){return this.stat=0,this},setOption:function(t){this.option=a(this.option,t)},drawCover:function(t,e){var a=this;if(0!==a.coverImg.width){var i=a.coverImg;if(a.context2d.save(),a.context2d.beginPath(),a.context2d.lineWidth=.5,a.context2d.globalCompositeOperation="source-over",a.context2d.rotate(2*Math.PI*t*2),a.context2d.arc(0,0,e-13,-Math.PI/2,2*Math.PI-Math.PI/2),a.context2d.stroke(),a.context2d.clip(),i.width/i.height>1){var o=2*e*(i.width-i.height)/i.height;a.context2d.drawImage(i,-e-10-o/2,-e-10,2*e*i.width/i.height,2*e)}else a.context2d.drawImage(i,-e-10,-e-10,2*e,2*e*i.height/i.width);a.context2d.restore()}},drawProgress:function(t,e,a){var i=this;i.context2d.beginPath(),t&&(i.context2d.strokeStyle=t,i.context2d.lineWidth=4,i.context2d.lineCap="round",i.context2d.shadowBlur=8),i.context2d.arc(0,0,a-10,-Math.PI/2,2*Math.PI*e-Math.PI/2),i.context2d.stroke()}},e}()),K=t=>(C("data-v-4ec7df35"),t=t(),_(),t),Q={class:"animt-css3"},Y={class:"title"},Z={class:"content"},tt={class:"name"},et={class:"text"},at=K((()=>l("audio",{id:"audios"},null,-1))),it=K((()=>l("canvas",{id:"canvas"},null,-1))),ot={style:{flex:"1"}},nt={class:"controller"},ct=M(t({name:"PlayHome",setup(t){const e=P(),r=B(),s=a([]),v=a(),y=z(),m=a(null),g=i((()=>y.state.audio.playFlag)),x=i((()=>y.state.audio.animation.flag)),w=i((()=>y.state.audio.animation.mode)),b=i((()=>y.state.audio.index)),A=i((()=>y.state.audio.currentPlay)),C=i((()=>y.state.audio.currentPlayLen)),_=a(!0),M=async(t,e)=>{var a,i,o,n;const c=await T({ids:e});s.value=null==c?void 0:c.songs,A.value.forEach(((a,i)=>{a.id===Number(e)&&(y.commit("setIndex",i),t=!1)})),t&&y.commit("setCurrentPlay",{name:null==(a=s.value[0])?void 0:a.name,songName:null==(o=null==(i=s.value[0])?void 0:i.ar[0])?void 0:o.name,id:Number(e),picUrl:null==(n=s.value[0])?void 0:n.al.picUrl})},I=async()=>{if(!x.value)return;const{data:t}=await j({id:A.value[b.value].id});y.commit("setLocalMusic",A.value[b.value]),t[0].url&&(async t=>{if(!v.value){await k();const t=document.querySelector("#audio"),e=document.querySelector("#canvas");v.value=new J(t,e,{effect:w.value,accuracy:128,circlewave:{maxHeight:80,minHeight:1,circleRadius:100,fadeSide:!1,maxParticle:100,shadowBlur:0,shadowColor:"rgba(244,244,244,1)"},circlebar:{maxHeight:80,minHeight:1,circleRadius:100,fadeSide:!1,maxParticle:100,shadowBlur:0,shadowColor:"rgba(244,244,244,1)"}})}fetch(t).then((t=>t.blob())).then((t=>{const e=new FileReader;0===t.type.indexOf("audio")&&(e.onload=function(t){v.value.audioSrc.src=t.target.result,v.value.audioSrc.play(),v.value.dance()},e.readAsDataURL(t))}))})(t[0].url)},H=()=>{_.value=!_.value};o(g,(async()=>{await k();const t=document.querySelector(".img-com");g.value?t.style.animationPlayState="running":t.style.animationPlayState="paused"}),{immediate:!0}),o([b,C],(async()=>{if(0===C.value)return void r.push("/");const t=A.value[b.value].id;"/play"===e.path&&r.replace({path:"play",query:{id:t}}),M(!1,t),I()})),o(w,((t,e)=>{v.value.setOption({effect:w.value})})),o(x,((t,e)=>{e&&window.location.reload()})),L((()=>{M(!0,e.query.id)}));const E=()=>{r.go(-1)};return(t,e)=>{var a,i,o,r,v;const y=S,g=R;return n(),c("div",Q,[l("div",{class:"bgcurl",style:u({background:`url(${null==(a=s.value[0])?void 0:a.al.picUrl}?param=100y100)`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"})},null,4),l("div",Y,[d(y,{class:"back",name:"down",onClick:E}),l("div",Z,[l("p",tt,h(null==(i=s.value[0])?void 0:i.name),1),l("p",et,h(null==(r=null==(o=s.value[0])?void 0:o.ar[0])?void 0:r.name),1)]),d(y,{name:"share-o"})]),d(G),p(l("div",{class:"img-rotate",ref_key:"imgrotate",ref:m},[at,it,d(g,{url:null==(v=s.value[0])?void 0:v.al.picUrl,size:"500",onClick:H},null,8,["url"])],512),[[f,_.value]]),p(l("div",ot,[d(X,{onShowlyric:H})],512),[[f,!_.value]]),l("div",nt,[d(W)])])}}}),[["__scopeId","data-v-4ec7df35"]]);export{ct as default};
