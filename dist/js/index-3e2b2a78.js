import{T as e,d as a,r as t,x as i,aM as l,ab as s,b as o,a9 as n,X as u,a1 as r,a2 as v,b4 as c,a8 as h,o as d,ac as p,Q as f,R as g,Y as w,c as m,ad as b,a3 as x,a5 as y,aq as C,Z as $,$ as M,aN as S,aK as z,a6 as T,ao as X}from"./index-f678d2ce.js";const[Y,I]=e("swipe"),O={loop:b,width:x,height:x,vertical:Boolean,autoplay:y(0),duration:y(500),touchable:b,lazyRender:Boolean,initialSwipe:y(0),indicatorColor:String,showIndicators:b,stopPropagation:b},k=Symbol(Y);const D=T(a({name:Y,props:O,emits:["change","dragStart","dragEnd"],setup(e,{emit:a,slots:b}){const x=t(),y=t(),T=i({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let X=!1;const Y=l(),{children:O,linkChildren:D}=s(k),E=o((()=>O.length)),P=o((()=>T[e.vertical?"height":"width"])),R=o((()=>e.vertical?Y.deltaY.value:Y.deltaX.value)),B=o((()=>{if(T.rect){return(e.vertical?T.rect.height:T.rect.width)-P.value*E.value}return 0})),j=o((()=>P.value?Math.ceil(Math.abs(B.value)/P.value):E.value)),q=o((()=>E.value*P.value)),A=o((()=>(T.active+E.value)%E.value)),F=o((()=>{const a=e.vertical?"vertical":"horizontal";return Y.direction.value===a})),H=o((()=>{const a={transitionDuration:`${T.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+T.offset.toFixed(2)}px)`};if(P.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${q.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a})),K=(a,t=0)=>{let i=a*P.value;e.loop||(i=Math.min(i,-B.value));let l=t-i;return e.loop||(l=z(l,B.value,0)),l},N=({pace:t=0,offset:i=0,emitChange:l})=>{if(E.value<=1)return;const{active:s}=T,o=(a=>{const{active:t}=T;return a?e.loop?z(t+a,-1,E.value):z(t+a,0,j.value):t})(t),n=K(o,i);if(e.loop){if(O[0]&&n!==B.value){const e=n<B.value;O[0].setOffset(e?q.value:0)}if(O[E.value-1]&&0!==n){const e=n>0;O[E.value-1].setOffset(e?-q.value:0)}}T.active=o,T.offset=n,l&&o!==s&&a("change",A.value)},Q=()=>{T.swiping=!0,T.active<=-1?N({pace:E.value}):T.active>=E.value&&N({pace:-E.value})},W=()=>{Q(),Y.reset(),C((()=>{T.swiping=!1,N({pace:1,emitChange:!0})}))};let Z;const G=()=>clearTimeout(Z),J=()=>{G(),+e.autoplay>0&&E.value>1&&(Z=setTimeout((()=>{W(),J()}),+e.autoplay))},L=(a=+e.initialSwipe)=>{if(!x.value)return;const t=()=>{var t,i;if(!$(x)){const a={width:x.value.offsetWidth,height:x.value.offsetHeight};T.rect=a,T.width=+(null!=(t=e.width)?t:a.width),T.height=+(null!=(i=e.height)?i:a.height)}E.value&&-1===(a=Math.min(E.value-1,a))&&(a=E.value-1),T.active=a,T.swiping=!0,T.offset=K(a),O.forEach((e=>{e.setOffset(0)})),J()};$(x)?M().then(t):t()},U=()=>L(T.active);let V;const _=a=>{!e.touchable||a.touches.length>1||(Y.start(a),X=!1,V=Date.now(),G(),Q())},ee=()=>{if(!e.touchable||!T.swiping)return;const t=Date.now()-V,i=R.value/t;if((Math.abs(i)>.25||Math.abs(R.value)>P.value/2)&&F.value){const a=e.vertical?Y.offsetY.value:Y.offsetX.value;let t=0;t=e.loop?a>0?R.value>0?-1:1:0:-Math[R.value>0?"ceil":"floor"](R.value/P.value),N({pace:t,emitChange:!0})}else R.value&&N({pace:0});X=!1,T.swiping=!1,a("dragEnd",{index:A.value}),J()},ae=(a,t)=>{const i=t===A.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return m("i",{style:l,class:I("indicator",{active:i})},null)};return n({prev:()=>{Q(),Y.reset(),C((()=>{T.swiping=!1,N({pace:-1,emitChange:!0})}))},next:W,state:T,resize:U,swipeTo:(a,t={})=>{Q(),Y.reset(),C((()=>{let i;i=e.loop&&a===E.value?0===T.active?0:a:a%E.value,t.immediate?C((()=>{T.swiping=!1})):T.swiping=!1,N({pace:i-T.active,emitChange:!0})}))}}),D({size:P,props:e,count:E,activeIndicator:A}),u((()=>e.initialSwipe),(e=>L(+e))),u(E,(()=>L(T.active))),u((()=>e.autoplay),J),u([r,v,()=>e.width,()=>e.height],U),u(c(),(e=>{"visible"===e?J():G()})),h(L),d((()=>L(T.active))),p((()=>L(T.active))),f(G),g(G),w("touchmove",(t=>{if(e.touchable&&T.swiping&&(Y.move(t),F.value)){!e.loop&&(0===T.active&&R.value>0||T.active===E.value-1&&R.value<0)||(S(t,e.stopPropagation),N({offset:R.value}),X||(a("dragStart",{index:A.value}),X=!0))}}),{target:y}),()=>{var a;return m("div",{ref:x,class:I()},[m("div",{ref:y,style:H.value,class:I("track",{vertical:e.vertical}),onTouchstartPassive:_,onTouchend:ee,onTouchcancel:ee},[null==(a=b.default)?void 0:a.call(b)]),b.indicator?b.indicator({active:A.value,total:E.value}):e.showIndicators&&E.value>1?m("div",{class:I("indicators",{vertical:e.vertical})},[Array(E.value).fill("").map(ae)]):void 0])}}})),[E,P]=e("swipe-item");const R=T(a({name:E,setup(e,{slots:a}){let t;const l=i({offset:0,inited:!1,mounted:!1}),{parent:s,index:u}=X(k);if(!s)return;const r=o((()=>{const e={},{vertical:a}=s.props;return s.size.value&&(e[a?"height":"width"]=`${s.size.value}px`),l.offset&&(e.transform=`translate${a?"Y":"X"}(${l.offset}px)`),e})),v=o((()=>{const{loop:e,lazyRender:a}=s.props;if(!a||t)return!0;if(!l.mounted)return!1;const i=s.activeIndicator.value,o=s.count.value-1,n=0===i&&e?o:i-1,r=i===o&&e?0:i+1;return t=u.value===i||u.value===n||u.value===r,t}));return h((()=>{M((()=>{l.mounted=!0}))})),n({setOffset:e=>{l.offset=e}}),()=>{var e;return m("div",{class:P(),style:r.value},[v.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{D as S,R as a};
