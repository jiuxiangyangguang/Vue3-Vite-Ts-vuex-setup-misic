var _t=Object.defineProperty,mt=Object.defineProperties;var yt=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var ot=(b,s,m)=>s in b?_t(b,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):b[s]=m,it=(b,s)=>{for(var m in s||(s={}))gt.call(s,m)&&ot(b,m,s[m]);if(at)for(var m of at(s))xt.call(s,m)&&ot(b,m,s[m]);return b},nt=(b,s)=>mt(b,yt(s));import{d as Y,a9 as ct,f as st,i as P,c as k,z as R,o as V,a as W,b as _,a6 as wt,g as $,h as z,u as O,E as Q,t as N,w as Z,v as tt,F as J,q as rt,s as lt,aa as bt,I as ut,x as et,y as dt,r as Ct,k as At,L as St}from"./vendor-eefdb645.js";import{_ as K,d as Mt,j as Pt,k as kt,l as Et,a as ht,u as ft,m as Ft,g as Bt,n as It,b as Lt}from"./index-9c02a660.js";/* empty css               */const Dt=b=>(rt("data-v-20f0a570"),b=b(),lt(),b),Ht=Dt(()=>_("div",{class:"title"},"\u8BF7\u9009\u62E9\u4E0B\u8F7D\u97F3\u8D28",-1)),zt={class:"progressbar"},$t={class:"text"},Ot={class:"text"},Tt={class:"icon"},jt=Y({setup(b){ct(B=>({"20f0a570-lineColor":O(o)}));const s=st(),m=P(""),w=P(!1),E=P(),M=k(()=>s.state.userInfo.likeArr),C=k(()=>s.state.audio.playFlag),g=k(()=>s.state.audio.index),t=k(()=>s.state.audio.mode),a=k(()=>s.state.skin.progress),o=k(()=>s.state.skin.lineColor),e=k(()=>s.state.audio.currentPlay),r=k(()=>s.state.audio.currentAudioLength),n=k(()=>s.state.audio.durationAudioLength),x=P(),v=P(),l=P(),h=P(!1),p=P(0),c=P(0),i=P(!1),f=Mt(),d=k(()=>M.value.some(B=>B===e.value[g.value].id)),L=()=>{s.commit("setPlayFlags")},u=async()=>{E.value.classList.add("anim-one"),setTimeout(()=>{E.value.classList.remove("anim-one")},500);const B=d.value?"setlikeArrRef":"setlikeArrAdd";s.commit(B,e.value[g.value].id),await Pt({like:d.value,id:e.value[g.value].id})},y=async B=>{const{data:I}=await kt({id:e.value[g.value].id,br:B});i.value=!1,I.url?(fetch(I.url).then(T=>T.blob()).then(T=>{const H=document.createElement("a");document.body.appendChild(H),H.style.display="none";const S=window.URL.createObjectURL(T);H.href=S,H.download=`${e.value[g.value].name}-${e.value[g.value].songName}.mp3`,H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(S)}),s.commit("setLocalMusic",e.value[g.value])):bt.fail("\u5F53\u524D\u6B4C\u66F2\u4E0D\u652F\u6301\u4E0B\u8F7D")},F=async()=>{await Et({id:e.value[g.value].id,limit:30})},D=B=>{h.value=!0;const I=l.value.offsetLeft;c.value=l.value.clientWidth;const H=B.targetTouches[0].pageX;p.value=H-I,p.value>=c.value&&(p.value=c.value),p.value<0&&(p.value=0),v.value.style.left=`${p.value}px`,x.value.style.width=`${p.value}px`},q=()=>{h.value=!1;const B=p.value/c.value*n.value;s.commit("setSetCurrentLen",B)},A=()=>{s.commit("setIndex",g.value-1)},j=()=>{s.commit("setIndex",g.value+1)},G=()=>{w.value=!0,setTimeout(()=>{w.value=!1},2e3);let B=t.value+1>=3?0:t.value+1;B===0?m.value="\u5217\u8868\u5FAA\u73AF":B===1?m.value="\u968F\u673A\u64AD\u653E":m.value="\u5355\u66F2\u5FAA\u73AF",s.commit("setMode",B)},X=()=>{s.commit("setShowPlayList")};return R(r,()=>{if(h.value)return;const B=Math.ceil(r.value)*100/Math.ceil(n.value);x.value.style.width=`${B}%`,v.value.style.left=`${B}%`}),(B,I)=>{const T=ut,H=ht;return V(),W(J,null,[i.value?(V(),W("div",{key:0,class:"mask",onClick:I[4]||(I[4]=S=>i.value=!1)},[_("div",{class:"updomn",onClick:I[3]||(I[3]=wt(()=>{},["stop"]))},[Ht,_("p",{onClick:I[0]||(I[0]=S=>y(128e3))},"\u6807\u51C6"),_("p",{onClick:I[1]||(I[1]=S=>y(32e4))},"\u8F83\u9AD8"),_("p",{onClick:I[2]||(I[2]=S=>y(999e3))},"\u6781\u9AD8(\u65E0\u635F)")])])):$("v-if",!0),$(" \u4E0B\u8F7D,\u6536\u85CF,\u8BC4\u8BBA "),_("div",{class:"collection",ref:(S,U)=>{U.collection=S,E.value=S}},[z(T,{name:"like",color:O(d)?"#ff5345":"#eee",onClick:u},null,8,["color"]),z(T,{name:"upgrade",color:"#fff",style:Q({transform:"rotate(180deg)"}),onClick:I[5]||(I[5]=S=>i.value=!0)},null,8,["style"]),z(T,{name:"chat-o",color:"#fff",onClick:F})],512),$(" \u8FDB\u5EA6\u6761 "),_("div",zt,[_("span",$t,N(O(f).getMS(O(r))),1),_("div",{class:"progress",ref:(S,U)=>{U.progress=S,l.value=S}},[_("div",{class:"speed",ref:(S,U)=>{U.speed=S,x.value=S}},null,512),_("div",{class:"dot",ref:(S,U)=>{U.dot=S,v.value=S},onTouchmove:D,onTouchend:q},[z(H,{name:O(a)},null,8,["name"])],544)],512),_("span",Ot,N(O(f).getMS(O(n))),1)]),$(" \u64AD\u653E\u63A7\u5236 "),_("div",Tt,[z(H,{name:O(t)===1?"sjbf":O(t)===0?"lbbf":"dqxh",style:Q({fontSize:"18px",color:O(o)}),onClick:G},null,8,["name","style"]),z(H,{name:"prev",onClick:A}),z(T,{onClick:L,name:O(C)?"pause-circle-o":"play-circle-o"},null,8,["name"]),z(H,{name:"next",onClick:j}),z(H,{name:"bflb",style:{"font-size":"18px"},onClick:X})]),$(" \u6A21\u5F0F\u63D0\u793A\u6846 "),Z(_("div",{class:"msak"},N(m.value),513),[[tt,w.value]])],64)}}});var Rt=K(jt,[["__scopeId","data-v-20f0a570"]]);const qt={class:"progressbar"},Ut=Y({setup(b){const s=st(),m=P(),w=k(()=>s.state.audio.volume),E=P(),M=P(),C=P(0),g=P(0),t=a=>{const o=M.value.offsetLeft;g.value=M.value.clientWidth;const r=a.targetTouches[0].pageX;C.value=r-o,C.value>=g.value&&(C.value=g.value),C.value<0&&(C.value=0),E.value.style.left=`${C.value}px`,m.value.style.width=`${C.value}px`,s.commit("setVolume",C.value/g.value)};return R(w,async()=>{await et(),g.value=M.value.clientWidth,C.value=g.value*w.value,E.value.style.left=`${C.value}px`,m.value.style.width=`${C.value}px`},{immediate:!0}),(a,o)=>{const e=ht;return V(),W(J,null,[$(" \u97F3\u91CF\u8FDB\u5EA6\u6761 "),_("div",qt,[z(e,{name:"volume100",style:{color:"#dcdbdb","font-size":"12px"}}),_("div",{class:"progressbgc",ref:(r,n)=>{n.progress=r,M.value=r}},[_("div",{class:"progressline",ref:(r,n)=>{n.speed=r,m.value=r}},null,512),_("div",{class:"dot",ref:(r,n)=>{n.dot=r,E.value=r},onTouchmove:t},null,544)],512)])],2112)}}});var Vt=K(Ut,[["__scopeId","data-v-4ef74af8"]]);const Wt=Y({emits:["showlyric"],setup(b,{emit:s}){ct(n=>({"6c46578c-lineColor":O(e)}));const m=dt(),w=ft(),E=P(),M=k(()=>w.state.audio.currentAudioLength),C=P([]),g=P(0),t=k(()=>w.state.audio.index),a=k(()=>w.state.audio.currentPlay),o=k(()=>w.state.audio.currentPlayLen),e=k(()=>w.state.skin.lineColor),r=async n=>{const{lrc:{lyric:x}}=await Ft({id:n}),v=[];x.split(`
`).forEach(l=>{const h=Number(l.slice(1,3)*60)+Number(l.slice(4,6)),p=l.indexOf("]");v.push({time:h,text:l.slice(p+1,l.length)})}),C.value=v};return R(M,n=>{const x=C.value.findIndex(v=>v.time===Math.floor(n));x!==-1&&(g.value=x)}),R(g,async()=>{if(m.path!=="/play")return;const n=g.value,x=document.querySelectorAll("li span");x.forEach(l=>{l.style.transition="background-size 0s linear",l.style.backgroundSize="0"});const v=C.value[n+1].time-C.value[n].time;x[n].style.transition=`background-size ${v}s linear`,x[n].style.backgroundSize="100%",E.value.style.top=`-${n*40}px`}),R([o,t,a],()=>{!o.value||(g.value=0,r(a.value[t.value].id))}),r(m.query.id),(n,x)=>(V(),W(J,null,[$(" \u6B4C\u8BCD\u7EC4\u4EF6 "),_("div",{class:"lyric",onClick:x[0]||(x[0]=v=>s("showlyric"))},[_("ul",{ref:(v,l)=>{l.ul=v,E.value=v}},[(V(!0),W(J,null,Ct(C.value,v=>(V(),W("li",null,[_("span",null,N(v.text),1)]))),256))],512)])],2112))}});var Nt=K(Wt,[["__scopeId","data-v-6c46578c"]]),vt={exports:{}};(function(b,s){(function(m){b.exports=m()})(function(){var m={effect:"waveform",accuracy:128,waveform:{maxHeight:80,minHeight:1,spacing:1,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle",prettify:!0},circlewave:{maxHeight:20,minHeight:-5,spacing:1,color:"#fcc",shadowBlur:2,shadowColor:"#caa",fadeSide:!0,prettify:!1,particle:!0,maxParticle:100,circleRadius:128,showProgress:!0},circlebar:{maxHeight:50,minHeight:1,spacing:1,color:"#fcc",shadowBlur:2,shadowColor:"#caa",fadeSide:!0,prettify:!1,particle:!0,maxParticle:100,circleRadius:128,showProgress:!0},lighting:{maxHeight:160,maxSize:8,lineWidth:2,color:"#fcc",shadowBlur:1,shadowColor:"#c20",fadeSide:!0,prettify:!0,horizontalAlign:"center",verticalAlign:"middle"}};function w(t,a,o){if(["[object HTMLAudioSource]","[object HTMLAudioElement]","[object MediaStream]"].indexOf(Object.prototype.toString.call(t))===-1)throw new TypeError("Invaild Audio Source");if(Object.prototype.toString.call(a)!=="[object HTMLCanvasElement]")throw new TypeError("Invaild Canvas Element");this.audioSrc=t,this.canvasEle=a,this.option=E(m,o),this.meta={},this.stat=0,this.freqByteData=null,this.particles=[],this.coverImg=new Image,this.__init()}function E(){var t={};return Array.prototype.forEach.call(arguments,function(a){var o;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(Object.prototype.toString.call(a[o])==="[object Object]"?t[o]=E(t[o],a[o]):t[o]=a[o])}),t}w.prototype={__init:function(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),a=Object.prototype.toString.call(this.audioSrc)!=="[object MediaStream]"?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc);this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,a.connect(this.analyser),this.analyser.fftSize=this.option.accuracy*2,this.analyser.connect(t.destination),this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.coverImg.src=this.option.circlewave.coverImg||"",this.context2d=this.canvasEle.getContext("2d");var o=document.createElement("canvas");this.memCtx=o.getContext("2d"),this.effects=this.__effects(),this.__resizeCanvas(),this.canvasEle.addEventListener("click",function(){this.stat===0?(this.audioSrc.play(),this.dance()):(this.pause(),this.audioSrc.pause())}.bind(this)),window.onresize=this.__resizeCanvas.bind(this)},__resizeCanvas(){var t=window.devicePixelRatio||1;this.width=this.canvasEle.clientWidth,this.height=this.canvasEle.clientHeight,this.canvasEle.width=this.width*t,this.canvasEle.height=this.height*t,this.context2d.scale(t,t),this.context2d.globalCompositeOperation="lighter",this.memCtx.canvas.width=this.width*t,this.memCtx.canvas.height=this.height*t,this.memCtx.scale(t,t)},__recreateAnalyzer(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),a=Object.prototype.toString.call(this.audioSrc)!=="[object MediaStream]"?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc);this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,a.connect(this.analyser),this.analyser.fftSize=this.option.accuracy*2,this.analyser.connect(t.destination)},__rebuildData:function(t,a){var o;return a==="center"?o=[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)):a==="left"?o=t:a==="right"?o=Array.from(t).reverse():o=[].concat(Array.from(t).reverse().slice(this.option.accuracy/2,this.option.accuracy),Array.from(t).slice(0,this.option.accuracy/2)),o},readAudioSrc:function(t,a,o){if(t.files.length===0){o.innerText="Drop Audio file here to play";return}var e=t.files[0],r=new FileReader;e.type.indexOf("audio")===0&&(o.innerText=e.name,r.onload=function(n){a.audioSrc.src=n.target.result,a.audioSrc.play(),a.dance()},r.readAsDataURL(e))},__animate:function(){this.stat===1&&(this.analyser.getByteFrequencyData(this.freqByteData),typeof this.effects[this.option.effect]=="function"&&this.effects[this.option.effect](this.freqByteData),requestAnimationFrame(this.__animate.bind(this)))},__testFrame:function(){this.analyser.getByteFrequencyData(this.freqByteData),typeof this.__effects()[this.option.effect]=="function"&&this.__effects()[this.option.effect](this.freqByteData)},__renderMemParticles:function(t,a,o){delete this.particles.find(function(e){return e.dead}),this.particles.length>50?this.particles.shift():this.particles.push(new M({x:Math.random()*this.width,y:Math.random()*100-50+this.height/2,vx:Math.random()*.2-.3,vy:Math.random()*.3-.4,size:Math.random()*5,life:Math.random()*50,type:o,color:a})),this.particles.forEach(e=>{e.update(this.context2d)})},__effects:function(){var t=this,a=[];return{lighting:function(o){var e=t.option.lighting,r=t.__rebuildData(o,e.horizontalAlign),n=e.maxHeight,x=e.prettify,v=e.dottify,l=e.maxSize,h=e.color,p=!0,c=!0,i,f,d;e.horizontalAlign!=="center"&&(c=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.lineWidth=e.lineWidth,t.context2d.strokeStyle="rgba(200, 200, 200, .2)",t.context2d.fillStyle="rgba(200, 200, 200, .2)",t.context2d.globalAlpha=.8,t.context2d.beginPath(),t.context2d.shadowBlur=4,t.context2d.shadowColor=t.context2d.fillStyle,t.__renderMemParticles(null,t.context2d.shadowColor,"rect"),h instanceof Array?(d=t.context2d.createLinearGradient(0,t.height/2,t.width,t.height/2),h.forEach(function(L,u){var y,F;L instanceof Array?F=L[1]:F=L,y=u/h.length,d.addColorStop(y,F)}),t.context2d.fillStyle=d,t.context2d.strokeStyle=d):(t.context2d.fillStyle=h,t.context2d.strokeStyle=h),r.forEach(function(L,u){x?u<t.option.accuracy/2?n=(1-(t.option.accuracy/2-1-u)/(t.option.accuracy/2))*e.maxHeight:n=(1-(u-t.option.accuracy/2)/(t.option.accuracy/2))*e.maxHeight:n=e.maxHeight,c?u<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-u)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(u-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,i=t.width/t.option.accuracy*u;var y=L/256*n;e.verticalAlign==="middle"?f=(t.height-y)/2:e.verticalAlign==="bottom"?f=t.height-y:e.verticalAlign==="top"?f=y:f=(t.height-y)/2,v&&u!==0&&u%2==0?(t.context2d.beginPath(),a[u]=a[u]!==void 0?a[u]:Math.random()*l+1,t.context2d.arc(i,f,a[u],0,Math.PI*2),t.context2d.fill()):v||(p?(t.context2d.moveTo(i,f),p=!1):t.context2d.lineTo(i,f))}),v||(t.context2d.stroke(),t.context2d.globalAlpha=.6,t.context2d.fill())},circlewave:function(o){var e=t.option.circlewave,r=e.fadeSide,n=e.prettify,x=t.__rebuildData(o,e.horizontalAlign),v=Math.PI*2/x.length,l,h,p,c,i,f,d=e.circleRadius,L=e.particle,u=e.maxParticle,y=e.showProgress,F=t.audioSrc.currentTime/t.audioSrc.duration,D=!0;if(i=e.color,e.horizontalAlign!=="center"&&(r=!1,n=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.save(),t.context2d.lineWidth=4,t.context2d.fillStyle="rgba(200, 200, 200, .2)",t.context2d.translate(t.width/2-.5,t.height/2-.5),e.shadowBlur>0&&(t.context2d.shadowBlur=e.shadowBlur,t.context2d.shadowColor=e.shadowColor),L){if(delete t.particles.find(function(A){return A.dead}),t.particles.length>u)t.particles.shift();else{const A=Math.random()*Math.PI*2;t.particles.push(new M({x:(d+30)*Math.sin(A),y:(d+30)*Math.cos(A),vx:.3*Math.sin(A)+Math.random()*.5-.3,vy:.3*Math.cos(A)+Math.random()*.5-.3,life:Math.random()*10}))}t.particles.forEach(A=>{A.update(t.context2d)})}t.context2d.beginPath(),x.forEach(function(A,j){h=(d*Math.PI-t.option.accuracy*e.spacing)/t.option.accuracy,c=j*(h+e.spacing),e.spacing!==1&&(c+=e.spacing/2),n?j<=t.option.accuracy/2?l=(1-(t.option.accuracy/2-1-j)/(t.option.accuracy/2))*e.maxHeight:l=(1-(j-t.option.accuracy/2)/(t.option.accuracy/2))*e.maxHeight:l=e.maxHeight,p=A/256*l,p=p<e.minHeight?e.minHeight:p,i instanceof Array?(f=t.context2d.createLinearGradient(-d-l,-d-l,d+l,d+l),i.forEach(function(I,T){var H,S;I instanceof Array?S=I[1]:S=I,H=T/i.length,f.addColorStop(H,S)}),t.context2d.strokeStyle=f,t.context2d.fillStyle=f):(t.context2d.strokeStyle=i,t.context2d.fillStyle=i),r?j<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-j)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(j-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1;var G=v*j,X=Math.sin(G)*(d+p),B=Math.cos(G)*(d+p);D?(t.context2d.moveTo(X,B),D=!1):t.context2d.lineTo(X,B)});var q=t.context2d.globalAlpha;t.context2d.closePath(),t.context2d.stroke(),t.context2d.globalAlpha=.5,t.context2d.fill(),t.context2d.globalAlpha=q,y&&t.drawProgress(i,F,d),t.drawCover(F,d),t.context2d.restore()},circlebar:function(o){var e=t.option.circlebar,r=e.fadeSide;e.prettify;var n=t.__rebuildData(o,e.horizontalAlign),x=Math.PI*2/n.length,v,l,h,p,c,i=e.circleRadius,f=e.particle,d=e.maxParticle,L=e.showProgress,u=t.audioSrc.currentTime/t.audioSrc.duration,y=0;if(e.horizontalAlign!=="center"&&(r=!1),t.context2d.clearRect(0,0,t.width,t.height),t.context2d.save(),t.context2d.translate(t.width/2-.5,t.height/2-.5),e.shadowBlur>0&&(t.context2d.shadowBlur=e.shadowBlur,t.context2d.shadowColor=e.shadowColor),f){if(delete t.particles.find(function(A){return A.dead}),t.particles.length>d)t.particles.shift();else{const A=Math.random()*Math.PI*2;t.particles.push(new M({x:(i+20)*Math.sin(A),y:(i+20)*Math.cos(A),vx:.3*Math.sin(A)+Math.random()*.5-.3,vy:.3*Math.cos(A)+Math.random()*.5-.3,life:Math.random()*10}))}t.particles.forEach(A=>{A.update(t.context2d)})}l=(i*Math.PI-t.option.accuracy*e.spacing)/t.option.accuracy,y=-l/2,c=e.color;var F=c instanceof Array?c[0]:c;t.context2d.fillStyle=F,t.context2d.strokeStyle=F,t.context2d.lineWidth=4,t.context2d.lineCap="round",t.context2d.shadowBlur=8,t.context2d.globalAlpha=1,t.context2d.beginPath();for(var D=n.length-1;D>=0;D--){var q=n[D];p=D*(l+e.spacing),e.spacing!==1&&(p+=e.spacing/2),v=e.maxHeight,h=q/256*v,h=h<e.minHeight?e.minHeight:h,r&&(D<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-D)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(D-t.option.accuracy/2)/(t.option.accuracy/2)),t.context2d.rotate(x),t.context2d.fillRect(y,i,l,h),t.context2d.fill()}L&&t.drawProgress(null,u,i),t.drawCover(u,i),t.context2d.restore()},waveform:function(o){var e=t.option.waveform,r=e.fadeSide,n=e.prettify,x=t.__rebuildData(o,e.horizontalAlign),v,l,h,p,c,i,f,d;e.horizontalAlign!=="center"&&(r=!1,n=!1),t.context2d.clearRect(0,0,t.width,t.height),x.forEach(function(L,u){l=(t.width-t.option.accuracy*e.spacing)/t.option.accuracy,p=u*(l+e.spacing),e.spacing!==1&&(p+=e.spacing/2),n?u<=t.option.accuracy/2?v=(1-(t.option.accuracy/2-1-u)/(t.option.accuracy/2))*e.maxHeight:v=(1-(u-t.option.accuracy/2)/(t.option.accuracy/2))*e.maxHeight:v=e.maxHeight,h=L/256*v,h=h<e.minHeight?e.minHeight:h,e.verticalAlign==="middle"?c=(t.height-h)/2:e.verticalAlign==="top"?c=0:e.verticalAlign==="bottom"?c=t.height-h:c=(t.height-h)/2,i=e.color,i instanceof Array?(f=t.context2d.createLinearGradient(p,c,p,c+h),i.forEach(function(y,F){y instanceof Array?(d=y[0],y=y[1]):F===0||F===i.length-1?d=F/(i.length-1):d=F/i.length+.5/i.length,f.addColorStop(d,y)}),t.context2d.fillStyle=f):t.context2d.fillStyle=i,e.shadowBlur>0&&(t.context2d.shadowBlur=e.shadowBlur,t.context2d.shadowColor=e.shadowColor),r?u<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-u)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(u-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,t.context2d.fillRect(p,c,l,h)})}}},dance:function(){return(this.stat===0||this.analyser.context.state==="suspended")&&(this.analyser.context.resume(),this.stat=1,this.__animate()),this},pause:function(){return this.stat=0,this},setOption:function(t){this.option=E(this.option,t)},drawCover:function(t,a){var o=this;if(o.coverImg.width!==0){var e=o.coverImg;if(o.context2d.save(),o.context2d.beginPath(),o.context2d.lineWidth=.5,o.context2d.globalCompositeOperation="source-over",o.context2d.rotate(Math.PI*2*t*2),o.context2d.arc(0,0,a-13,-Math.PI/2,Math.PI*2-Math.PI/2),o.context2d.stroke(),o.context2d.clip(),e.width/e.height>1){var r=a*2*(e.width-e.height)/e.height;o.context2d.drawImage(e,-a-10-r/2,-a-10,a*2*e.width/e.height,a*2)}else o.context2d.drawImage(e,-a-10,-a-10,a*2,a*2*e.height/e.width);o.context2d.restore()}},drawProgress:function(t,a,o){var e=this;e.context2d.beginPath(),t&&(e.context2d.strokeStyle=t,e.context2d.lineWidth=4,e.context2d.lineCap="round",e.context2d.shadowBlur=8),e.context2d.arc(0,0,o-10,-Math.PI/2,Math.PI*2*a-Math.PI/2),e.context2d.stroke()}};function M(t){this.x=t.x||0,this.y=t.y||0,this.vx=t.vx||Math.random()-.5,this.vy=t.vy||Math.random()-.5,this.size=t.size||Math.random()*3,this.life=t.life||Math.random()*5,this.dead=!1,this.alpha=1,this.rotate=0,this.color=t.color||"rgba(244,244,244,.9)",this.type=t.type||"circle",this.update=C,this.render=g}function C(t){if(this.x+=this.vx,this.y+=this.vy,this.life-=.01,this.alpha-=.003,this.rotate+=Math.random()*.01,this.life<0){this.dead=!0,this.alpha=0;return}this.render(t)}function g(t){var a=this,o=t.globalAlpha;t.fillStyle=a.color,a.type==="circle"?(t.beginPath(),t.globalAlpha=a.alpha,t.arc(a.x,a.y,a.size,0,Math.PI*2),t.fill()):(t.save(),t.translate(a.x,a.y),t.rotate(a.rotate),t.rect(0,0,a.size,a.size),t.restore(),t.fill()),t.globalAlpha=o}return w})})(vt);var Gt=vt.exports;const pt=b=>(rt("data-v-817f8e96"),b=b(),lt(),b),Xt={class:"animt-css3"},Yt={class:"title"},Jt={class:"content"},Kt={class:"name"},Qt={class:"text"},Zt=pt(()=>_("audio",{id:"audios"},null,-1)),te=pt(()=>_("canvas",{id:"canvas"},null,-1)),ee={style:{flex:"1"}},ae={class:"controller"},oe={name:"PlayHome"};function ie(b){const s=dt(),m=At(),w=P([]),E=P(),M=ft(),C=P(null),g=k(()=>M.state.audio.playFlag),t=k(()=>M.state.audio.animation.flag),a=k(()=>M.state.audio.animation.mode),o=k(()=>M.state.audio.index),e=k(()=>M.state.audio.currentPlay),r=k(()=>M.state.audio.currentPlayLen),n=P(!0),x=async(c,i)=>{var d,L,u,y;const f=await Bt({ids:i});w.value=f==null?void 0:f.songs,e.value.forEach((F,D)=>{F.id===Number(i)&&(M.commit("setIndex",D),c=!1)}),c&&M.commit("setCurrentPlay",{name:(d=w.value[0])==null?void 0:d.name,songName:(u=(L=w.value[0])==null?void 0:L.ar[0])==null?void 0:u.name,id:Number(i),picUrl:(y=w.value[0])==null?void 0:y.al.picUrl})},v=async c=>{if(!E.value){await et();const i=document.querySelector("#audio"),f=document.querySelector("#canvas");E.value=new Gt(i,f,{effect:a.value,accuracy:128,circlewave:{maxHeight:80,minHeight:1,circleRadius:100,fadeSide:!1,maxParticle:100,shadowBlur:0,shadowColor:"rgba(244,244,244,1)"},circlebar:{maxHeight:80,minHeight:1,circleRadius:100,fadeSide:!1,maxParticle:100,shadowBlur:0,shadowColor:"rgba(244,244,244,1)"}})}fetch(c).then(i=>i.blob()).then(i=>{const f=new FileReader;i.type.indexOf("audio")===0&&(f.onload=function(d){E.value.audioSrc.src=d.target.result,E.value.audioSrc.play(),E.value.dance()},f.readAsDataURL(i))})},l=async()=>{if(!t.value)return;const{data:c}=await It({id:e.value[o.value].id});M.commit("setLocalMusic",e.value[o.value]),c[0].url&&v(c[0].url)},h=()=>{n.value=!n.value};R(g,async()=>{await et();const c=document.querySelector(".img-com");g.value?c.style.animationPlayState="running":c.style.animationPlayState="paused"},{immediate:!0}),R([o,r],async()=>{if(r.value===0){m.push("/");return}const c=e.value[o.value].id;s.path==="/play"&&m.replace({path:"play",query:{id:c}}),x(!1,c),l()}),R(a,(c,i)=>{E.value.setOption({effect:a.value})}),R(t,(c,i)=>{i&&window.location.reload()}),St(()=>{x(!0,s.query.id)});const p=()=>{m.go(-1)};return(c,i)=>{var L,u,y,F,D;const f=ut,d=Lt;return V(),W("div",Xt,[$(" \u80CC\u666F\u6A21\u7CCA\u76D2\u5B50 "),_("div",{class:"bgcurl",style:Q({background:`url(${(L=w.value[0])==null?void 0:L.al.picUrl}?param=100y100)`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"})},null,4),$(" \u6B4C\u66F2\u540D\u79F0 "),_("div",Yt,[z(f,{class:"back",name:"down",onClick:p}),_("div",Jt,[_("p",Kt,N((u=w.value[0])==null?void 0:u.name),1),_("p",Qt,N((F=(y=w.value[0])==null?void 0:y.ar[0])==null?void 0:F.name),1)]),z(f,{name:"share-o"})]),$(" \u97F3\u91CF\u63A7\u5236\u7EC4\u4EF6 "),z(Vt),$(" \u56FE\u7247\u65CB\u8F6C\u7EC4\u4EF6 "),Z(_("div",{class:"img-rotate",ref:(q,A)=>{A.imgrotate=q,C.value=q}},[Zt,te,z(d,{url:(D=w.value[0])==null?void 0:D.al.picUrl,size:"500",onClick:h},null,8,["url"])],512),[[tt,n.value]]),$(" \u6B4C\u8BCD\u7EC4\u4EF6 "),Z(_("div",ee,[z(Nt,{onShowlyric:h})],512),[[tt,!n.value]]),$(" \u8FDB\u5EA6\u6761--\u64AD\u653E\u7EC4\u4EF6 "),_("div",ae,[z(Rt)])])}}const ne=Y(nt(it({},oe),{setup:ie}));var ue=K(ne,[["__scopeId","data-v-817f8e96"]]);export{ue as default};
